# PokÃ©mon TCG Price Dataset Pipeline

This repository contains a Python pipeline that builds and maintains a **master PokÃ©mon TCG dataset** from [tcgcsv.com](https://tcgcsv.com), which provides daily price archives from TCGPlayer.

The pipeline:
1. **Ingests** daily archives of card prices.  
2. **Extracts & normalizes** raw JSON into partitioned Parquet files.  
3. **Fetches metadata** (products & groups) via the TCGCSV API.  
4. **Merges** prices + products + groups into a curated dataset partitioned by day.  
5. **Optionally builds a full dataset** in a single Parquet file (incrementally appended).  
6. **Cleans up** temporary files and prunes raw archives to save space.  

---

## âš™ï¸ Installation

This project uses [**uv**](https://docs.astral.sh/uv/) for dependency management.

```bash
# Clone the repository
git clone https://github.com/<your-username>/ptcg-term-project.git
cd pctg-term-project

# Install dependencies into a virtual environment
uv sync
```

---

## ğŸš€ Usage

Run the pipeline from the repo root:

```bash
uv run python pokemon-tcg-pricing/scripts/create_data/tcgcsv_pokemon_pipeline.py     --start-date 2024-02-08     --end-date 2025-09-28     --interval 1     --base-dir ./data     --full-file
```

### Arguments
- `--start-date` â†’ first date to harvest (YYYY-MM-DD).  
- `--end-date` â†’ last date to harvest (YYYY-MM-DD).  
- `--interval` â†’ spacing between dates (1 = daily, 7 = weekly).  
- `--base-dir` â†’ output directory (default `./pokemon-tcg-pricing/data`).  
- `--keep-extracted` â†’ if set, donâ€™t delete extracted raw archives.  
- `--full-file` â†’ also generate/append to one big merged Parquet file.  

### Typical Daily Run
For a daily update (most common case):

```bash
uv run python pokemon-tcg-pricing/scripts/create_data/tcgcsv_pokemon_pipeline.py     --start-date $(date -d "yesterday" +%Y-%m-%d)     --end-date $(date -d "yesterday" +%Y-%m-%d)     --interval 1     --base-dir ./data     --full-file
```

## ğŸ› ï¸ Makefile Shortcuts

This repository includes a **Makefile** so you donâ€™t have to type long commands each time.

### Full History (Feb 8, 2024 â†’ Today)
```bash
make full-history
```
Runs the pipeline for the entire history of TCGCSV data and updates the `daily/` partitions.

```bash
make full-history-full
```
Same as above, but also rebuilds the combined `pokemon_prices_with_full_features.parquet`.

---

### Daily Update (Yesterday Only)
```bash
make yesterday
```
Fetches just yesterdayâ€™s archive and updates `daily/`.

```bash
make yesterday-full
```
Same as above, but also appends/rebuilds the full parquet file.

---

These commands assume:
- `uv` is installed and configured.
- Youâ€™re running from the repository root.

---

## ğŸ§¹ Storage Management

- Raw `daily_prices/` â†’ automatically pruned to keep only the **last 7 days**.  
- Temporary `archives/` and `extracted/` â†’ always deleted after each run.  
- Curated `daily/` â†’ permanent, partitioned dataset (use this for analysis).  
- Full file (`pokemon_prices_with_full_features.parquet`) â†’ permanent convenience file.  

---

## ğŸ“Š Dataset Summary

- **Rows**: ~23M (as of Sept 2025).  
- **Columns**: 31 (numeric + categorical).  
- **Applications**: market trend forecasting, rarity classification, collectible asset analysis.

---

# PokÃ©mon TCG Master Dataset Description

This document describes the curated dataset generated by the PokÃ©mon TCG price pipeline.

---

## Overview

- **Time range**: February 8, 2024 â†’ Current (continuously growing).  
- **Update frequency**: Can be updated by running the pipeline script daily.  
- **Scope**: Covers all PokÃ©mon products, including both cards and sealed items.  
- **Pipeline script**: `scripts/create_data/tcgcsv_pokemon_pipeline.py`  
- **Core outputs**:  
  - `data/daily/` â†’ Partitioned daily dataset (main analysis dataset).  
  - `data/pokemon_prices_with_full_features.parquet` â†’ Optional combined file containing all days.  

---

## File Structure

### Daily Partitioned Dataset (`data/daily/`)
- **Format**: Apache Parquet  
- **Compression**: ZSTD  
- **Partitioning**: One subfolder per date, e.g.:  
  ```text
  data/daily/date=2024-02-08/part.parquet
  data/daily/date=2024-02-09/part.parquet
  ...
  ```
- Each partition contains **all curated data for that date**.  

### Full Combined Dataset (`data/pokemon_prices_with_full_features.parquet`)
- **Format**: Single flat Apache Parquet file  
- **Compression**: ZSTD  
- Contains the union of all daily partitions.  
- Updated incrementally to append new days when available.  

---

## Data Size (as of 2025-09-28)

- **Total rows**: 23,841,769  
- **Total columns**: 31  
- **Unique dates**: 599 (from 2024-02-08 to 2025-09-28)  
- **Typical daily rows**: ~37k at start â†’ ~42k by Sept 2025 (growth due to new products/sets).  

---

## Deduplication

The dataset is deduplicated on **exactly matched rows**.  
- Any rows with identical values across all 31 columns are collapsed to a single entry.  
- Variants (`sub_type_name`, e.g., Normal / Holo / Reverse Holo) are **preserved** as separate rows.  

---

## Data Dictionary

### Identifiers & Keys
- **product_id** *(int)* â€“ Unique numeric identifier for the product (card or sealed item).  
- **groupid** *(string)* â€“ Identifier for the productâ€™s group (usually corresponds to a set).  
- **date** *(date)* â€“ Observation date (YYYY-MM-DD).  

### Price Metrics
- **low_price** *(float)* â€“ Lowest listed price in USD for the product on that day.  
- **mid_price** *(float)* â€“ Median listing price in USD for the product on that day.  
- **high_price** *(float)* â€“ Highest listed price in USD for the product on that day.  
- **market_price** *(float)* â€“ Estimated fair market value in USD (tcgplayer-calculated).  
- **direct_low_price** *(float)* â€“ Lowest listing price in USD from TCGPlayer Direct sellers.  

### Product Details
- **sub_type_name** *(string)* â€“ Variant type (e.g., â€œNormalâ€, â€œHoloâ€, â€œReverse Holoâ€).  
- **name** *(string)* â€“ Product name (often includes card name, set, and variant).  
- **clean_name** *(string)* â€“ Normalized product name (stripped formatting/symbols).  
- **category_id_x** *(int)* â€“ Category identifier (always 3 for PokÃ©mon).  
- **modified_on_x** *(timestamp)* â€“ Last modification timestamp for product-level metadata.  
- **card_text** *(string)* â€“ Card text/rules text. Empty for sealed products.  
- **upc** *(string)* â€“ UPC code, if available (mostly for sealed products).  
- **number** *(string)* â€“ Card number within the set (e.g., â€œ15/108â€).  
- **rarity** *(string)* â€“ Rarity classification (e.g., â€œCommonâ€, â€œRare Holoâ€).  
- **card_type** *(string)* â€“ Card type (e.g., â€œPokÃ©monâ€, â€œTrainerâ€, â€œEnergyâ€).  
- **hp** *(string/int)* â€“ Hit points for PokÃ©mon cards. Empty for non-PokÃ©mon.  
- **stage** *(string)* â€“ Evolution stage (e.g., â€œBasicâ€, â€œStage 1â€, â€œStage 2â€). Empty for non-PokÃ©mon.  
- **attack_1** *(string)* â€“ First listed attack name/details. Empty if not applicable.  
- **attack_2** *(string)* â€“ Second listed attack name/details. Empty if not applicable.  
- **weakness** *(string)* â€“ Weakness attribute (e.g., â€œWater Ã—2â€). Empty for non-PokÃ©mon.  
- **resistance** *(string)* â€“ Resistance attribute (e.g., â€œFighting -20â€). Empty if none.  
- **retreat_cost** *(string)* â€“ Retreat cost in energy symbols. Empty for non-PokÃ©mon.  

### Group (Set) Metadata
- **set_name** *(string)* â€“ Name of the set/group (e.g., â€œRising Rivalsâ€).  
- **abbreviation** *(string)* â€“ Set abbreviation (e.g., â€œRRâ€).  
- **is_supplemental** *(bool)* â€“ Whether the set is supplemental (not part of mainline).  
- **release_date** *(date)* â€“ Official release date of the set/group.  
- **modified_on_y** *(timestamp)* â€“ Last modification timestamp for group-level metadata.  
- **category_id_y** *(int)* â€“ Category identifier at group-level (always 3 for PokÃ©mon).  

---

## ğŸ“‚ Directory Layout

```text
pokemon-tcg-pricing/
â”‚
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ create_data/
â”‚       â”œâ”€â”€ inspect_full_dataset.py
â”‚       â””â”€â”€ tcgcsv_pokemon_pipeline.py     # main pipeline script
â”‚
â””â”€â”€ data/ (created at runtime)
    â”œâ”€â”€ archives/                      # temporary downloaded archives (auto-cleaned)
    â”œâ”€â”€ extracted/                     # temporary extraction dirs (auto-cleaned)
    â”œâ”€â”€ daily_prices/                  # raw per-day prices (keeps last 7 days only)
    â”œâ”€â”€ daily/                         # curated dataset, partitioned by day
    â”œâ”€â”€ groups.parquet                 # cached group metadata
    â”œâ”€â”€ products.parquet               # cached product metadata
    â””â”€â”€ pokemon_prices_with_full_features.parquet   # optional combined file
```
