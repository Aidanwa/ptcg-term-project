# Pokémon TCG Price Dataset Pipeline

This repository contains a Python pipeline that builds and maintains a **master Pokémon TCG dataset** from [tcgcsv.com](https://tcgcsv.com), which provides daily price archives from TCGPlayer.

The pipeline:
1. **Ingests** daily archives of card prices.  
2. **Extracts & normalizes** raw JSON into partitioned Parquet files.  
3. **Fetches metadata** (products & groups) via the TCGCSV API.  
4. **Merges** prices + products + groups into a curated dataset partitioned by day.  
5. **Optionally builds a full dataset** in a single Parquet file (incrementally appended).  
6. **Cleans up** temporary files and prunes raw archives to save space.  

---

## ⚙️ Installation

This project uses [**uv**](https://docs.astral.sh/uv/) for dependency management.

```bash
# Clone the repository
git clone https://github.com/<your-username>/ptcg-term-project.git
cd pctg-term-project

# Install dependencies into a virtual environment
uv sync
```

---

## 🚀 Usage

Run the pipeline from the repo root:

```bash
uv run python pokemon-tcg-pricing/scripts/create_data/tcgcsv_pokemon_pipeline.py     --start-date 2024-02-08     --end-date 2025-09-28     --interval 1     --base-dir ./data     --full-file
```

### Arguments
- `--start-date` → first date to harvest (YYYY-MM-DD).  
- `--end-date` → last date to harvest (YYYY-MM-DD).  
- `--interval` → spacing between dates (1 = daily, 7 = weekly).  
- `--base-dir` → output directory (default `./pokemon-tcg-pricing/data`).  
- `--keep-extracted` → if set, don’t delete extracted raw archives.  
- `--full-file` → also generate/append to one big merged Parquet file.  

### Typical Daily Run
For a daily update (most common case):

```bash
uv run python pokemon-tcg-pricing/scripts/create_data/tcgcsv_pokemon_pipeline.py     --start-date $(date -d "yesterday" +%Y-%m-%d)     --end-date $(date -d "yesterday" +%Y-%m-%d)     --interval 1     --base-dir ./data     --full-file
```

## 🛠️ Makefile Shortcuts

This repository includes a **Makefile** so you don’t have to type long commands each time.

### Full History (Feb 8, 2024 → Today)
```bash
make full-history
```
Runs the pipeline for the entire history of TCGCSV data and updates the `daily/` partitions.

```bash
make full-history-full
```
Same as above, but also rebuilds the combined `pokemon_prices_with_full_features.parquet`.

---

### Daily Update (Yesterday Only)
```bash
make yesterday
```
Fetches just yesterday’s archive and updates `daily/`.

```bash
make yesterday-full
```
Same as above, but also appends/rebuilds the full parquet file.

---

These commands assume:
- `uv` is installed and configured.
- You’re running from the repository root.

---

## 🧹 Storage Management

- Raw `daily_prices/` → automatically pruned to keep only the **last 7 days**.  
- Temporary `archives/` and `extracted/` → always deleted after each run.  
- Curated `daily/` → permanent, partitioned dataset (use this for analysis).  
- Full file (`pokemon_prices_with_full_features.parquet`) → permanent convenience file.  

---

## 📊 Dataset Summary

- **Rows**: ~23M (as of Sept 2025).  
- **Columns**: 31 (numeric + categorical).  
- **Applications**: market trend forecasting, rarity classification, collectible asset analysis.

---

# Pokémon TCG Master Dataset Description

This document describes the curated dataset generated by the Pokémon TCG price pipeline.

---

## Overview

- **Time range**: February 8, 2024 → Current (continuously growing).  
- **Update frequency**: Can be updated by running the pipeline script daily.  
- **Scope**: Covers all Pokémon products, including both cards and sealed items.  
- **Pipeline script**: `scripts/create_data/tcgcsv_pokemon_pipeline.py`  
- **Core outputs**:  
  - `data/daily/` → Partitioned daily dataset (main analysis dataset).  
  - `data/pokemon_prices_with_full_features.parquet` → Optional combined file containing all days.  

---

## File Structure

### Daily Partitioned Dataset (`data/daily/`)
- **Format**: Apache Parquet  
- **Compression**: ZSTD  
- **Partitioning**: One subfolder per date, e.g.:  
  ```text
  data/daily/date=2024-02-08/part.parquet
  data/daily/date=2024-02-09/part.parquet
  ...
  ```
- Each partition contains **all curated data for that date**.  

### Full Combined Dataset (`data/pokemon_prices_with_full_features.parquet`)
- **Format**: Single flat Apache Parquet file  
- **Compression**: ZSTD  
- Contains the union of all daily partitions.  
- Updated incrementally to append new days when available.  

---

## Data Size (as of 2025-09-28)

- **Total rows**: 23,841,769  
- **Total columns**: 31  
- **Unique dates**: 599 (from 2024-02-08 to 2025-09-28)  
- **Typical daily rows**: ~37k at start → ~42k by Sept 2025 (growth due to new products/sets).  

---

## Deduplication

The dataset is deduplicated on **exactly matched rows**.  
- Any rows with identical values across all 31 columns are collapsed to a single entry.  
- Variants (`sub_type_name`, e.g., Normal / Holo / Reverse Holo) are **preserved** as separate rows.  

---

## Data Dictionary

### Identifiers & Keys
- **product_id** *(int)* – Unique numeric identifier for the product (card or sealed item).  
- **groupid** *(string)* – Identifier for the product’s group (usually corresponds to a set).  
- **date** *(date)* – Observation date (YYYY-MM-DD).  

### Price Metrics
- **low_price** *(float)* – Lowest listed price in USD for the product on that day.  
- **mid_price** *(float)* – Median listing price in USD for the product on that day.  
- **high_price** *(float)* – Highest listed price in USD for the product on that day.  
- **market_price** *(float)* – Estimated fair market value in USD (tcgplayer-calculated).  
- **direct_low_price** *(float)* – Lowest listing price in USD from TCGPlayer Direct sellers.  

### Product Details
- **sub_type_name** *(string)* – Variant type (e.g., “Normal”, “Holo”, “Reverse Holo”).  
- **name** *(string)* – Product name (often includes card name, set, and variant).  
- **clean_name** *(string)* – Normalized product name (stripped formatting/symbols).  
- **category_id_x** *(int)* – Category identifier (always 3 for Pokémon).  
- **modified_on_x** *(timestamp)* – Last modification timestamp for product-level metadata.  
- **card_text** *(string)* – Card text/rules text. Empty for sealed products.  
- **upc** *(string)* – UPC code, if available (mostly for sealed products).  
- **number** *(string)* – Card number within the set (e.g., “15/108”).  
- **rarity** *(string)* – Rarity classification (e.g., “Common”, “Rare Holo”).  
- **card_type** *(string)* – Card type (e.g., “Pokémon”, “Trainer”, “Energy”).  
- **hp** *(string/int)* – Hit points for Pokémon cards. Empty for non-Pokémon.  
- **stage** *(string)* – Evolution stage (e.g., “Basic”, “Stage 1”, “Stage 2”). Empty for non-Pokémon.  
- **attack_1** *(string)* – First listed attack name/details. Empty if not applicable.  
- **attack_2** *(string)* – Second listed attack name/details. Empty if not applicable.  
- **weakness** *(string)* – Weakness attribute (e.g., “Water ×2”). Empty for non-Pokémon.  
- **resistance** *(string)* – Resistance attribute (e.g., “Fighting -20”). Empty if none.  
- **retreat_cost** *(string)* – Retreat cost in energy symbols. Empty for non-Pokémon.  

### Group (Set) Metadata
- **set_name** *(string)* – Name of the set/group (e.g., “Rising Rivals”).  
- **abbreviation** *(string)* – Set abbreviation (e.g., “RR”).  
- **is_supplemental** *(bool)* – Whether the set is supplemental (not part of mainline).  
- **release_date** *(date)* – Official release date of the set/group.  
- **modified_on_y** *(timestamp)* – Last modification timestamp for group-level metadata.  
- **category_id_y** *(int)* – Category identifier at group-level (always 3 for Pokémon).  

---

## 📂 Directory Layout

```text
pokemon-tcg-pricing/
│
├── scripts/
│   └── create_data/
│       ├── inspect_full_dataset.py
│       └── tcgcsv_pokemon_pipeline.py     # main pipeline script
│
└── data/ (created at runtime)
    ├── archives/                      # temporary downloaded archives (auto-cleaned)
    ├── extracted/                     # temporary extraction dirs (auto-cleaned)
    ├── daily_prices/                  # raw per-day prices (keeps last 7 days only)
    ├── daily/                         # curated dataset, partitioned by day
    ├── groups.parquet                 # cached group metadata
    ├── products.parquet               # cached product metadata
    └── pokemon_prices_with_full_features.parquet   # optional combined file
```
